subject_set{1} = {...
% '/Users/david/Box Sync/behavioral/data/S187/S1877375323416877363.mat',...
'/Users/david/Box Sync/behavioral/data/S187/S1877375323466959521.mat',...
'/Users/david/Box Sync/behavioral/data/S187/S1877375323515573230.mat',...
'/Users/david/Box Sync/behavioral/data/S187/S1877375323563647243.mat',...
'/Users/david/Box Sync/behavioral/data/S187/S1877375323612439207.mat',...
'/Users/david/Box Sync/behavioral/data/S187/S187b7375323710371562.mat',...
};

subject_set{2} = {...
% '/Users/david/Box Sync/behavioral/data/S188/S1887375323833949972.mat',...
'/Users/david/Box Sync/behavioral/data/S188/S1887375323888113991.mat',...
'/Users/david/Box Sync/behavioral/data/S188/S1887375323937230863.mat',...
'/Users/david/Box Sync/behavioral/data/S188/S1887375323990700467.mat',...
'/Users/david/Box Sync/behavioral/data/S188/S1887375324041065671.mat',...
'/Users/david/Box Sync/behavioral/data/S188/S188b7375324135548513.mat',...
};

subject_set{3} = {...
'/Users/david/Box Sync/behavioral/data/S189/S1897375324262454112.mat',...
'/Users/david/Box Sync/behavioral/data/S189/S1897375324308832014.mat',...
'/Users/david/Box Sync/behavioral/data/S189/S1897375324354606170.mat',...
'/Users/david/Box Sync/behavioral/data/S189/S1897375324404275864.mat',...
'/Users/david/Box Sync/behavioral/data/S189/S189b7375324492602632.mat',...
'/Users/david/Box Sync/behavioral/data/S189/S189b7375324538566195.mat',...
};

subject_set{4} = {...
'/Users/david/Box Sync/behavioral/data/S190/S1907375324698089528.mat',...
'/Users/david/Box Sync/behavioral/data/S190/S1907375324751859569.mat',...
'/Users/david/Box Sync/behavioral/data/S190/S1907375324804648121.mat',...
'/Users/david/Box Sync/behavioral/data/S190/S1907375324868017512.mat',...
'/Users/david/Box Sync/behavioral/data/S190/S190b7375325003225144.mat',...
'/Users/david/Box Sync/behavioral/data/S190/S190b7375325051463281.mat',...
};

subject_set{5} = {...
'/Users/david/Box Sync/behavioral/data/S191/S1917375354335971780.mat',...
'/Users/david/Box Sync/behavioral/data/S191/S1917375354384527237.mat',...
'/Users/david/Box Sync/behavioral/data/S191/S1917375354431962586.mat',...
'/Users/david/Box Sync/behavioral/data/S191/S1917375354479302194.mat',...
'/Users/david/Box Sync/behavioral/data/S191/S191b7375354555358764.mat',...
'/Users/david/Box Sync/behavioral/data/S191/S191b7375354601772630.mat',...
};

subject_set{6} = {...
'/Users/david/Box Sync/behavioral/data/S192/S1927375354701024918.mat',...
'/Users/david/Box Sync/behavioral/data/S192/S1927375354749088959.mat',...
'/Users/david/Box Sync/behavioral/data/S192/S1927375354796579221.mat',...
'/Users/david/Box Sync/behavioral/data/S192/S1927375354843603979.mat',...
'/Users/david/Box Sync/behavioral/data/S192/S192b7375354922692084.mat',...
'/Users/david/Box Sync/behavioral/data/S192/S192b7375354969458088.mat',...
};

subject_set{7} = {...
'/Users/david/Box Sync/behavioral/data/S193/S1937375355168448072.mat',...
'/Users/david/Box Sync/behavioral/data/S193/S1937375355216809193.mat',...
'/Users/david/Box Sync/behavioral/data/S193/S1937375355265444702.mat',...
'/Users/david/Box Sync/behavioral/data/S193/S1937375355314073786.mat',...
'/Users/david/Box Sync/behavioral/data/S193/S193b7375355400060911.mat',...
'/Users/david/Box Sync/behavioral/data/S193/S193b7375355446971629.mat',...
};

subject_set{8} = {...
'/Users/david/Box Sync/behavioral/data/S194/S1947375356030646419.mat',...
'/Users/david/Box Sync/behavioral/data/S194/S1947375356080043456.mat',...
'/Users/david/Box Sync/behavioral/data/S194/S1947375356127198993.mat',...
'/Users/david/Box Sync/behavioral/data/S194/S1947375356175630403.mat',...
'/Users/david/Box Sync/behavioral/data/S194/S194b7375356264054426.mat',...
};

subject_set{9} = {...
'/Users/david/Box Sync/behavioral/data/S195/S1957375356362240376.mat',...
'/Users/david/Box Sync/behavioral/data/S195/S1957375356408958728.mat',...
'/Users/david/Box Sync/behavioral/data/S195/S1957375356456332831.mat',...
'/Users/david/Box Sync/behavioral/data/S195/S1957375356503363416.mat',...
'/Users/david/Box Sync/behavioral/data/S195/S195b7375356584221182.mat',...
'/Users/david/Box Sync/behavioral/data/S195/S195b7375356631430011.mat',...
};

subject_set{10} = {...
'/Users/david/Box Sync/behavioral/data/S196/S1967375356800084147.mat',...
'/Users/david/Box Sync/behavioral/data/S196/S1967375356851073736.mat',...
'/Users/david/Box Sync/behavioral/data/S196/S1967375356902169866.mat',...
'/Users/david/Box Sync/behavioral/data/S196/S1967375356952827375.mat',...
'/Users/david/Box Sync/behavioral/data/S196/S196b7375357064817584.mat',...
'/Users/david/Box Sync/behavioral/data/S196/S196b7375357113468100.mat',...
};

subject_set{11} = {...
'/Users/david/Box Sync/behavioral/data/S197/S1977375365129505397.mat',...
'/Users/david/Box Sync/behavioral/data/S197/S1977375365177326180.mat',...
'/Users/david/Box Sync/behavioral/data/S197/S1977375365224498949.mat',...
'/Users/david/Box Sync/behavioral/data/S197/S1977375365271443111.mat',...
'/Users/david/Box Sync/behavioral/data/S197/S197b7375365365428277.mat',...
'/Users/david/Box Sync/behavioral/data/S197/S197b7375365413106374.mat',...
};

subject_set{12} = {...
'/Users/david/Box Sync/behavioral/data/S198/S1987375375109175850.mat',...
'/Users/david/Box Sync/behavioral/data/S198/S1987375375158650292.mat',...
'/Users/david/Box Sync/behavioral/data/S198/S1987375375208649468.mat',...
'/Users/david/Box Sync/behavioral/data/S198/S1987375375261335926.mat',...
'/Users/david/Box Sync/behavioral/data/S198/S198b7375375351858578.mat',...
'/Users/david/Box Sync/behavioral/data/S198/S198b7375375405136790.mat',...
};

subject_set{13} = {...
    '/Users/david/Box Sync/behavioral/data/S201/S2017375394287320198.mat',...
'/Users/david/Box Sync/behavioral/data/S201/S2017375394339157329.mat',...
'/Users/david/Box Sync/behavioral/data/S201/S2017375394387408874.mat',...
'/Users/david/Box Sync/behavioral/data/S201/S2017375394434863854.mat',...
'/Users/david/Box Sync/behavioral/data/S201/S201b7375394523646365.mat',...
'/Users/david/Box Sync/behavioral/data/S201/S201b7375394571336014.mat',...
};

subject_set{14} = {...
    '/Users/david/Box Sync/behavioral/data/S221/S2217375477997096687.mat',...
'/Users/david/Box Sync/behavioral/data/S221/S2217375478044600954.mat',...
'/Users/david/Box Sync/behavioral/data/S221/S2217375478091062771.mat',...
'/Users/david/Box Sync/behavioral/data/S221/S2217375478138875063.mat',...
'/Users/david/Box Sync/behavioral/data/S221/S2217375478186192670.mat',...
'/Users/david/Box Sync/behavioral/data/S221/S221b7375478278683227.mat',...
}; %this subject got a mixed block as penultimate and symbol-only as ultiamte

subject_set{15} = {...
    '/Users/david/Box Sync/behavioral/data/S222/S2227375478460554777.mat',...
'/Users/david/Box Sync/behavioral/data/S222/S2227375478506643410.mat',...
'/Users/david/Box Sync/behavioral/data/S222/S2227375478553539179.mat',...
'/Users/david/Box Sync/behavioral/data/S222/S2227375478600444102.mat',...
'/Users/david/Box Sync/behavioral/data/S222/S2227375478647397734.mat',...
'/Users/david/Box Sync/behavioral/data/S222/S222b7375478729533984.mat',...
}; %this subject got a mixed block as penultimate and symbol-only as ultiamte

subject_set{16} = {...
'/Users/david/Box Sync/behavioral/data/S231/S2317377025967586897.mat',...
'/Users/david/Box Sync/behavioral/data/S231/S2317377026023359748.mat',...
'/Users/david/Box Sync/behavioral/data/S231/S2317377026073856415.mat',...
'/Users/david/Box Sync/behavioral/data/S231/S2317377026125352934.mat',...
'/Users/david/Box Sync/behavioral/data/S231/S231b7377026207019504.mat',...
'/Users/david/Box Sync/behavioral/data/S231/S231b7377026254854026.mat',...
}; 

subject_set{17} = {...
'/Users/david/Box Sync/behavioral/data/S232/S2327377026357110913.mat',...
'/Users/david/Box Sync/behavioral/data/S232/S2327377026405411292.mat',...
'/Users/david/Box Sync/behavioral/data/S232/S2327377026453496329.mat',...
'/Users/david/Box Sync/behavioral/data/S232/S2327377026501736452.mat',...
'/Users/david/Box Sync/behavioral/data/S232/S232b7377026581930234.mat',...
'/Users/david/Box Sync/behavioral/data/S232/S232b7377026629750979.mat',...
}; 

subject_set{18} = {...
'/Users/david/Box Sync/behavioral/data/S233/S2337377026768312092.mat',...
'/Users/david/Box Sync/behavioral/data/S233/S2337377026816442119.mat',...
'/Users/david/Box Sync/behavioral/data/S233/S2337377026865119266.mat',...
'/Users/david/Box Sync/behavioral/data/S233/S2337377026914131296.mat',...
'/Users/david/Box Sync/behavioral/data/S233/S233b7377026984102647.mat',...
'/Users/david/Box Sync/behavioral/data/S233/S233b7377027036807098.mat',...
}; 

subject_set{19} = {...
'/Users/david/Box Sync/behavioral/data/S234/S2347377027148448640.mat',...
'/Users/david/Box Sync/behavioral/data/S234/S2347377027196231219.mat',...
'/Users/david/Box Sync/behavioral/data/S234/S2347377027244470743.mat',...
'/Users/david/Box Sync/behavioral/data/S234/S2347377027294850177.mat',...
'/Users/david/Box Sync/behavioral/data/S234/S234b7377027361525530.mat',...
'/Users/david/Box Sync/behavioral/data/S234/S234b7377027407830282.mat',...
};

subject_set{20} = {...
'/Users/david/Box Sync/behavioral/data/S235/S2357377235947097183.mat',...
'/Users/david/Box Sync/behavioral/data/S235/S2357377235994880018.mat',...
'/Users/david/Box Sync/behavioral/data/S235/S2357377236089530424.mat',...
'/Users/david/Box Sync/behavioral/data/S235/S2357377236136416695.mat',...
'/Users/david/Box Sync/behavioral/data/S235/S235b7377236203192283.mat',...
'/Users/david/Box Sync/behavioral/data/S235/S235b7377236250789554.mat',...
};
%% combine block data from each subject into a data set structure:
all_blocks = 1:6;
desired_output_blocks = 1:5;
blocks_to_combine = [5, 6];

data_sets = cell(1, length(subject_set));
for i_sub = 1:length(subject_set)
    sub_data_set = cell(1, length(desired_output_blocks));
    sub_blocks = 1:length(subject_set{i_sub});

    sub_indiv_blocks = intersect(...
        setdiff(all_blocks, blocks_to_combine),...
        sub_blocks);
    sub_combine_blocks = intersect(...
        blocks_to_combine,...
        sub_blocks);
    for i_block = 1:length(sub_indiv_blocks)
        load(subject_set{i_sub}{sub_indiv_blocks(i_block)});
        sub_data_set{i_block} = Data;
    end
    param_comb = struct('trial_type', [], 'trial_home_numbers', [],...
            'trial_target_numbers', [], 'trial_stimA_numbers', [], 'prescribed_PT', []);
    Data_comb = struct(...
        'MT', [],...
        'RT', [],...
        'Succ', [],...
        'pPT', [],...
        'time_targ_disp', [],...
        'time_stimA_disp', [],...
        'Type', [],...
        'ViewTime', [],...
        'Kinematics', {},...
        'EventTimes', [], ...
        'Target', [],...
        'Home', [], ...
        'Score', []);
    for i_block = 1:length(sub_combine_blocks)
        load(subject_set{i_sub}{sub_combine_blocks(i_block)});
        Data_comb(1).MT = [Data_comb.MT; Data.MT];
        Data_comb(1).RT = [Data_comb.RT; Data.RT];
        Data_comb(1).Succ = [Data_comb.Succ; Data.Succ];
        Data_comb(1).pPT = [Data_comb.pPT; Data.pPT];
        Data_comb(1).time_targ_disp = [Data_comb.time_targ_disp; Data.time_targ_disp];
        Data_comb(1).time_stimA_disp = [Data_comb.time_stimA_disp; Data.time_stimA_disp];
        Data_comb(1).Type = [Data_comb.Type; Data.Type];
        Data_comb(1).ViewTime = [Data_comb.ViewTime; Data.ViewTime];
        Data_comb(1).Target = [Data_comb.Target; Data.Target];
        Data_comb(1).Home = [Data_comb.Home; Data.Home];
        Data_comb(1).Score = [Data_comb.Score; Data.Score];
        Data_comb(1).Kinematics = [Data_comb.Kinematics; Data.Kinematics];
        Data_comb(1).EventTimes = [Data_comb.EventTimes; Data.EventTimes];

        param_comb(1).trial_type = [param_comb.trial_type, Data.params.trial_type];
        param_comb(1).trial_home_numbers = [param_comb.trial_home_numbers, Data.params.trial_home_numbers];
        param_comb(1).trial_target_numbers = [param_comb.trial_target_numbers, Data.params.trial_target_numbers];
        param_comb(1).trial_stimA_numbers = [param_comb.trial_stimA_numbers, Data.params.trial_stimA_numbers];
        param_comb(1).prescribed_PT = [param_comb.prescribed_PT, Data.params.prescribed_PT];
    end
    Data_comb.params = param_comb;
    sub_data_set{desired_output_blocks(end)} = Data_comb;
    data_sets{i_sub} = sub_data_set;
end

% if ~exist('data_sets.mat', 'file')
    save data_sets_v3 data_sets
% end
%% plot each subject's trajectories for each block:
for i_sub = 5 %1:length(subject_set)
    figure;
    for i_block = 1:length(subject_set{i_sub})
        load(subject_set{i_sub}{i_block});
        subplot(2,3, i_block);
        [pd, err_] = process_block(Data);
        plot(pd.x, pd.y, '.-');
    end
    data_sets{i_sub} = sub_data_set;
end
